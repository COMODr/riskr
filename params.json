{"name":"Riskr","tagline":"","body":"# riskr\r\n<!-- README.md is generated from README.Rmd -->\r\n\r\n\r\n\r\n[![travis-status](https://api.travis-ci.org/jbkunst/riskr.svg)](https://travis-ci.org/jbkunst/riskr)\r\n[![Coverage Status](https://coveralls.io/repos/jbkunst/riskr/badge.svg?branch=master&service=github)](https://coveralls.io/github/jbkunst/riskr?branch=master)\r\n\r\n\r\n## Introduction\r\n\r\nThe `riskr` package facilitate *credit scoring* tasks such as measure the scores/models performance and make easy the scoring modelling process.\r\n\r\nThere are function to:\r\n\r\n 1. Measure in a simple way the performance of models via wrappers/shortcuts from ROCR functions.\r\n 2. Visualize relationships between variables.\r\n 4. Compute usual values in the credit scoring PSI, WOE, IV, KS, AUCROC, among others.\r\n 5. Make easier the modelling and validation process. \r\n\r\n## Assumptions\r\n\r\n`riskr` assume the target variable is *binary* with numeric values: 0 and 1. Usually 1 means the characteristic of interest.\r\n\r\n## Installation\r\n\r\nYou can install the latest development version from github with:\r\n\r\n\r\n```r\r\ndevtools::install_github(\"jbkunst/riskr\")\r\n```\r\n\r\n## Functions\r\n\r\nUsually we have a data frame with a *target* variable and a *score* (or probability) like this:\r\n\r\n\r\n```r\r\nlibrary(\"riskr\")\r\n\r\ndata(\"predictions\")\r\n\r\nhead(predictions)\r\n```\r\n\r\n\r\n\r\n| score| target|\r\n|-----:|------:|\r\n| 0.202|      1|\r\n| 0.806|      1|\r\n| 0.513|      1|\r\n| 0.052|      0|\r\n| 0.329|      1|\r\n| 0.246|      0|\r\n\r\n```r\r\n\r\nstr(predictions)\r\n## 'data.frame':\t10000 obs. of  2 variables:\r\n##  $ score : num  0.2023 0.8058 0.5134 0.0525 0.3288 ...\r\n##  $ target: num  1 1 1 0 1 0 1 0 1 1 ...\r\n\r\nscore <- predictions$score\r\n\r\ntarget <- predictions$target\r\n```\r\n\r\n### Performance Indicators\r\n\r\nThe main statistics or indicators are KS, AUCROC so:\r\n\r\n\r\n```r\r\nks(score, target)\r\n## [1] 0.254\r\n\r\naucroc(score, target)\r\n## [1] 0.676\r\n\r\ngini(score, target)\r\n## [1] 0.353\r\n\r\nperf(score, target)\r\n```\r\n\r\n\r\n\r\n| count| target_count| target_rate|    ks| aucroc|  gini| divergence|\r\n|-----:|------------:|-----------:|-----:|------:|-----:|----------:|\r\n| 10000|         6990|       0.699| 0.254|  0.676| 0.353|      0.408|\r\n\r\nThere are some functions to plot the score/model performance (based on ggplot package).\r\n\r\n\r\n```r\r\nplot_roc(score, target)\r\n```\r\n\r\n<img src=\"vignettes/figures/unnamed-chunk-4-1.png\" title=\"\" alt=\"\" style=\"display: block; margin: auto;\" />\r\n\r\n```r\r\n\r\nplot_gain(score, target)\r\n```\r\n\r\n<img src=\"vignettes/figures/unnamed-chunk-4-2.png\" title=\"\" alt=\"\" style=\"display: block; margin: auto;\" />\r\n\r\n```r\r\n\r\nplot_lift(score, target)\r\n```\r\n\r\n<img src=\"vignettes/figures/unnamed-chunk-4-3.png\" title=\"\" alt=\"\" style=\"display: block; margin: auto;\" />\r\n\r\n```r\r\n\r\nplot_dists(score, target) +\r\n  ggtitle(sprintf(\"The KS statistics is %.0f%%\", 100 * ks(score, target)))\r\n```\r\n\r\n<img src=\"vignettes/figures/unnamed-chunk-4-4.png\" title=\"\" alt=\"\" style=\"display: block; margin: auto;\" />\r\n\r\n```r\r\n\r\nplot_ks(score, target) + ggtitle(\"Comparing ECDF\")\r\n```\r\n\r\n<img src=\"vignettes/figures/unnamed-chunk-4-5.png\" title=\"\" alt=\"\" style=\"display: block; margin: auto;\" />\r\n\r\n\r\n```r\r\nplot_perf(score, target)\r\n```\r\n\r\n<img src=\"vignettes/figures/unnamed-chunk-5-1.png\" title=\"\" alt=\"\" style=\"display: block; margin: auto;\" />\r\n\r\n### Odds Tables\r\n\r\nThe odds tables are other way to show how a score/model performs.\r\n\r\n\r\n```r\r\nscore <- round(predictions$score * 1000)\r\n\r\nodds_table(score, target, nclass = 5) # default is (nclass =) 10 groups of equal size\r\n```\r\n\r\n\r\n\r\n|class     | count| percent| target_count| target_rate| target_percent| non_target_count| non_target_percent| odds|    woe|    iv|\r\n|:---------|-----:|-------:|------------:|-----------:|--------------:|----------------:|------------------:|----:|------:|-----:|\r\n|[1,164]   |  2009|   0.201|         1010|       0.503|          0.144|              999|              0.332| 1.01| -0.832| 0.156|\r\n|(164,331] |  1991|   0.199|         1255|       0.630|          0.180|              736|              0.245| 1.71| -0.309| 0.020|\r\n|(331,526] |  2008|   0.201|         1429|       0.712|          0.204|              579|              0.192| 2.47|  0.061| 0.001|\r\n|(526,738] |  2000|   0.200|         1573|       0.786|          0.225|              427|              0.142| 3.68|  0.461| 0.038|\r\n|(738,996] |  1992|   0.199|         1723|       0.865|          0.246|              269|              0.089| 6.41|  1.015| 0.159|\r\n\r\n```r\r\n\r\nodds_table(score, target, breaks = c(0, 300, 700, 999))\r\n```\r\n\r\n\r\n\r\n|class     | count| percent| target_count| target_rate| target_percent| non_target_count| non_target_percent| odds|    woe|    iv|\r\n|:---------|-----:|-------:|------------:|-----------:|--------------:|----------------:|------------------:|----:|------:|-----:|\r\n|(0,300]   |  3675|   0.368|         2052|       0.558|          0.294|             1623|              0.539| 1.26| -0.608| 0.149|\r\n|(300,700] |  3978|   0.398|         2926|       0.736|          0.419|             1052|              0.350| 2.78|  0.180| 0.012|\r\n|(700,999] |  2347|   0.235|         2012|       0.857|          0.288|              335|              0.111| 6.01|  0.950| 0.168|\r\n\r\n### Confusion Matrix\r\n\r\nThe `conf_matrix` function return a list with the next elements:\r\n\r\n\r\n```r\r\nscore_cat <- ifelse(score < 500, 0, 1)\r\n\r\ncm <- conf_matrix(score_cat, target)\r\n```\r\n\r\n- The confusion matrix:\r\n\r\n```r\r\ncm$confusion.matrix\r\n```\r\n\r\n\r\n\r\n|   |class  | pred 0| pred 1|\r\n|:--|:------|------:|------:|\r\n|0  |true 0 |   2230|    780|\r\n|1  |true 1 |   3476|   3514|\r\n\r\n- The confusion matrix statistics\r\n\r\n```r\r\ncm$indicators\r\n```\r\n\r\n\r\n\r\n|term                                  |term.short | value|\r\n|:-------------------------------------|:----------|-----:|\r\n|Accuracy                              |AC         | 0.574|\r\n|Recall &#124; True Positive rate (GG) |Recall     | 0.503|\r\n|False Positive rate                   |FP         | 0.259|\r\n|True Negative rate (BB)               |TN         | 0.741|\r\n|False Negative rate                   |FN         | 0.497|\r\n|Precision                             |P          | 0.818|\r\n\r\n```r\r\n\r\ncm$indicators.t\r\n```\r\n\r\n\r\n\r\n|    AC| Recall|    FP|    TN|    FN|     P|\r\n|-----:|------:|-----:|-----:|-----:|-----:|\r\n| 0.574|  0.503| 0.259| 0.741| 0.497| 0.818|\r\n\r\n\r\n### Bivariate Tables\r\n\r\n\r\n```r\r\ndata(\"credit\")\r\n\r\nstr(credit)\r\n## 'data.frame':\t49694 obs. of  17 variables:\r\n##  $ id_client          : int  1 7 9 12 14 19 22 26 28 30 ...\r\n##  $ sex                : chr  \"F\" \"F\" \"F\" \"F\" ...\r\n##  $ marital_status     : chr  \"O\" \"S\" \"S\" \"C\" ...\r\n##  $ age                : int  44 22 27 32 36 46 17 20 71 46 ...\r\n##  $ flag_res_phone     : chr  \"N\" \"Y\" \"Y\" \"Y\" ...\r\n##  $ area_code_res_phone: int  31 31 31 31 31 50 50 50 31 31 ...\r\n##  $ payment_day        : int  12 12 20 12 12 12 12 12 18 8 ...\r\n##  $ residence_type     : chr  \"P\" \"A\" \"A\" \"P\" ...\r\n##  $ months_in_residence: int  12 0 0 24 120 360 12 12 96 72 ...\r\n##  $ months_in_the_job  : int  48 48 0 0 36 120 12 24 12 12 ...\r\n##  $ profession_code    : int  731 999 950 165 15 704 38 39 13 801 ...\r\n##  $ flag_other_card    : chr  \"N\" \"N\" \"N\" \"N\" ...\r\n##  $ flag_mobile_phone  : chr  \"N\" \"N\" \"N\" \"N\" ...\r\n##  $ flag_contact_phone : chr  \"N\" \"N\" \"N\" \"N\" ...\r\n##  $ personal_net_income: num  300 410 1000 700 1987 ...\r\n##  $ quant_add_cards    : int  0 0 0 0 1 0 0 0 0 0 ...\r\n##  $ bad                : int  0 0 1 0 0 0 1 1 0 0 ...\r\n\r\nft(credit$marital_status)\r\n```\r\n\r\n\r\n\r\n|class | count| percent|\r\n|:-----|-----:|-------:|\r\n|S     | 25249|   0.508|\r\n|C     | 17097|   0.344|\r\n|O     |  2776|   0.056|\r\n|V     |  2430|   0.049|\r\n|D     |  2142|   0.043|\r\n\r\n```r\r\n\r\nbt(credit$marital_status, credit$bad)\r\n```\r\n\r\n\r\n\r\n|class | count| percent| target_count| target_rate| target_percent| non_target_count| non_target_percent|  odds|    woe|    iv|\r\n|:-----|-----:|-------:|------------:|-----------:|--------------:|----------------:|------------------:|-----:|------:|-----:|\r\n|C     | 17097|   0.344|         2483|       0.145|          0.253|            14614|              0.366| 0.170| -0.370| 0.042|\r\n|D     |  2142|   0.043|          322|       0.150|          0.033|             1820|              0.046| 0.177| -0.330| 0.004|\r\n|O     |  2776|   0.056|          660|       0.238|          0.067|             2116|              0.053| 0.312|  0.237| 0.003|\r\n|S     | 25249|   0.508|         6059|       0.240|          0.617|            19190|              0.481| 0.316|  0.249| 0.034|\r\n|V     |  2430|   0.049|          289|       0.119|          0.029|             2141|              0.054| 0.135| -0.600| 0.015|\r\n\r\n```r\r\n\r\nlibrary(\"ggplot2\")\r\n\r\ncredit$age_bin <- cut_interval(credit$age, 3)\r\n\r\nbt(credit$age_bin, credit$bad)\r\n```\r\n\r\n\r\n\r\n|class       | count| percent| target_count| target_rate| target_percent| non_target_count| non_target_percent|  odds|    woe|    iv|\r\n|:-----------|-----:|-------:|------------:|-----------:|--------------:|----------------:|------------------:|-----:|------:|-----:|\r\n|[15,41.7]   | 35654|   0.717|         8174|       0.229|          0.833|            27480|              0.689| 0.297|  0.190| 0.027|\r\n|(41.7,68.3] | 13313|   0.268|         1585|       0.119|          0.162|            11728|              0.294| 0.135| -0.599| 0.079|\r\n|(68.3,95]   |   727|   0.015|           54|       0.074|          0.006|              673|              0.017| 0.080| -1.121| 0.013|\r\n\r\n\r\n```r\r\nplot_ba(credit$age_bin, credit$bad)\r\n```\r\n\r\n<img src=\"vignettes/figures/unnamed-chunk-11-1.png\" title=\"\" alt=\"\" style=\"display: block; margin: auto;\" />\r\n\r\n```r\r\n\r\n# order by odds\r\nlvls_rt <- bt(credit$residence_type, credit$bad) %>% \r\n  arrange(desc(odds)) %>%  .[[\"class\"]]\r\n\r\nresidence_type2 <- factor(credit$residence_type, levels = lvls_rt)\r\n\r\nplot_ba(residence_type2, credit$bad)\r\n```\r\n\r\n<img src=\"vignettes/figures/unnamed-chunk-11-2.png\" title=\"\" alt=\"\" style=\"display: block; margin: auto;\" />\r\n\r\nThe minified version of `plot_ba`\r\n\r\n```r\r\nplot_ba2(credit$age_bin, credit$bad) + ggtitle(\"Age\")\r\n```\r\n\r\n<img src=\"vignettes/figures/unnamed-chunk-12-1.png\" title=\"\" alt=\"\" style=\"display: block; margin: auto;\" />\r\n\r\n```r\r\n\r\n\r\nplot_ba2(credit$flag_res_phone, credit$bad, labels = FALSE) +\r\n  ggtitle(\"Flag Response Phone\")\r\n```\r\n\r\n<img src=\"vignettes/figures/unnamed-chunk-12-2.png\" title=\"\" alt=\"\" style=\"display: block; margin: auto;\" />\r\n\r\n## Related work\r\n\r\n1. [woe](http://github.com/tomasgreif/woe) package by [tomasgreif](http://github.com/tomasgreif)\r\n1. [smbinning](http://cran.r-project.org/web/packages/smbinning) package by [Herman Jopia](http://github.com/hjopia). [Github repository](https://github.com/cran/smbinning).\r\n1. [Guide to Credit Scoring in R](https://cran.r-project.org/doc/contrib/Sharma-CreditScoring.pdf)\r\n1. [Gains package](https://cran.r-project.org/web/packages/gains/gains.pdf)\r\n\r\n## Session Info\r\n\r\n```r\r\nlibrary(\"riskr\")\r\nlibrary(\"printr\")\r\nlibrary(\"ggplot2\")\r\nlibrary(\"ggthemes\")\r\noptions(digits = 3, knitr.table.format = \"markdown\")\r\nknitr::opts_chunk$set(collapse = TRUE, warning = FALSE,\r\n                      fig.path = \"vignettes/figures/\",\r\n                      fig.width = 6, fig.height = 6,\r\n                      fig.align = \"center\", dpi = 72)\r\n\r\ntheme_set(theme_fivethirtyeight(base_size = 11) +\r\n            theme(axis.title = element_text(colour = \"grey30\"),\r\n                  axis.title.y = element_text(angle = 90),\r\n                  strip.background = element_rect(fill = \"#434348\"),\r\n                  strip.text = element_text(color = \"#F0F0F0\"),\r\n                  plot.title = element_text(face = \"plain\", size = structure(1.2, class = \"rel\"))))\r\nupdate_geom_defaults(\"line\", list(colour = \"#434348\", size = 1.05))\r\nupdate_geom_defaults(\"point\", list(colour = \"#434348\", size = 3))\r\nupdate_geom_defaults(\"bar\", list(fill = \"#7cb5ec\"))\r\nupdate_geom_defaults(\"text\", list(size = 4, colour = \"gray30\"))\r\n```\r\n\r\n\r\n```r\r\nprint(sessionInfo())\r\n## R version 3.2.0 (2015-04-16)\r\n## Platform: i386-w64-mingw32/i386 (32-bit)\r\n## Running under: Windows 7 (build 7601) Service Pack 1\r\n## \r\n## locale:\r\n## [1] LC_COLLATE=Spanish_Chile.1252  LC_CTYPE=Spanish_Chile.1252   \r\n## [3] LC_MONETARY=Spanish_Chile.1252 LC_NUMERIC=C                  \r\n## [5] LC_TIME=Spanish_Chile.1252    \r\n## \r\n## attached base packages:\r\n## [1] stats     graphics  grDevices utils     datasets  methods   base     \r\n## \r\n## other attached packages:\r\n##  [1] tidyr_0.2.0    plyr_1.8.3     dplyr_0.4.1    scales_0.2.5  \r\n##  [5] ROCR_1.0-7     gplots_2.17.0  ggthemes_2.2.1 ggplot2_1.0.1 \r\n##  [9] printr_0.0.4   riskr_1.0     \r\n## \r\n## loaded via a namespace (and not attached):\r\n##  [1] Rcpp_0.11.6        knitr_1.10.5       magrittr_1.5      \r\n##  [4] MASS_7.3-40        munsell_0.4.2      colorspace_1.2-6  \r\n##  [7] stringr_1.0.0      highr_0.5          caTools_1.17.1    \r\n## [10] tools_3.2.0        parallel_3.2.0     grid_3.2.0        \r\n## [13] gtable_0.1.2       KernSmooth_2.23-14 DBI_0.3.1         \r\n## [16] gtools_3.5.0       htmltools_0.2.6    lazyeval_0.1.10   \r\n## [19] assertthat_0.1     yaml_2.1.13        digest_0.6.8      \r\n## [22] reshape2_1.4.1     formatR_1.2        bitops_1.0-6      \r\n## [25] evaluate_0.7       rmarkdown_0.7      labeling_0.3      \r\n## [28] gdata_2.16.1       stringi_0.5-5      proto_0.3-10\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}