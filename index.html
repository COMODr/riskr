<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Riskr by jbkunst</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/jbkunst/riskr">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/jbkunst/riskr/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/jbkunst/riskr/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Riskr</h1>
          <p></p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/jbkunst">jbkunst</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a id="riskr" class="anchor" href="#riskr" aria-hidden="true"><span class="octicon octicon-link"></span></a>riskr</h1>



<h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>The <code>riskr</code> package facilitate repetitive <em>bussines risk</em> (or other areas) tasks. In general this package helps to:</p>

<ol>
<li>Measure in a easy way the performance of models via wrapper or shortcuts from ROCR functions.</li>
<li>Visualize relationships between variables.</li>
<li>Facilitate the usual and repetitives tasks.</li>
</ol>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>You can install the latest development version from github with:</p>

<div class="highlight highlight-r"><pre><span class="pl-e">devtools</span><span class="pl-k">::</span>install_github(<span class="pl-s"><span class="pl-pds">"</span>jbkunst/riskr<span class="pl-pds">"</span></span>)</pre></div>

<h2>
<a id="facts" class="anchor" href="#facts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Facts</h2>

<p><code>riskr</code> assume the target variable is binary with numeric values: 0 and 1. Usually 1 means the characteristic of interest.</p>

<h2>
<a id="functions" class="anchor" href="#functions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Functions</h2>

<p>Usually we have a data frame with a <em>target</em> variable and a <em>score</em> (or probability) like this:</p>

<div class="highlight highlight-r"><pre>library(<span class="pl-s"><span class="pl-pds">"</span>riskr<span class="pl-pds">"</span></span>)

data(<span class="pl-s"><span class="pl-pds">"</span>predictions<span class="pl-pds">"</span></span>)

head(<span class="pl-smi">predictions</span>)</pre></div>

<table>
<thead>
<tr>
<th align="right">score</th>
<th align="right">target</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0.202</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">0.806</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">0.513</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">0.052</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">0.329</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">0.246</td>
<td align="right">0</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-r"><pre>
str(<span class="pl-smi">predictions</span>)
<span class="pl-c">#&gt; 'data.frame':    10000 obs. of  2 variables:</span>
<span class="pl-c">#&gt;  $ score : num  0.2023 0.8058 0.5134 0.0525 0.3288 ...</span>
<span class="pl-c">#&gt;  $ target: num  1 1 1 0 1 0 1 0 1 1 ...</span>

<span class="pl-smi">score</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">predictions</span><span class="pl-k">$</span><span class="pl-smi">score</span>

<span class="pl-smi">target</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">predictions</span><span class="pl-k">$</span><span class="pl-smi">target</span></pre></div>

<h3>
<a id="performance-indicators" class="anchor" href="#performance-indicators" aria-hidden="true"><span class="octicon octicon-link"></span></a>Performance Indicators</h3>

<p>The main statistics or indicators are KS, AUCROC so:</p>

<div class="highlight highlight-r"><pre>ks(<span class="pl-smi">score</span>, <span class="pl-smi">target</span>)
<span class="pl-c">#&gt; [1] 0.254</span>

aucroc(<span class="pl-smi">score</span>, <span class="pl-smi">target</span>)
<span class="pl-c">#&gt; [1] 0.676</span>

gini(<span class="pl-smi">score</span>, <span class="pl-smi">target</span>)
<span class="pl-c">#&gt; [1] 0.353</span>

score_indicators(<span class="pl-smi">score</span>, <span class="pl-smi">target</span>)</pre></div>

<table>
<thead>
<tr>
<th align="right">count</th>
<th align="right">target_count</th>
<th align="right">target_rate</th>
<th align="right">ks</th>
<th align="right">aucroc</th>
<th align="right">gini</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">10000</td>
<td align="right">6990</td>
<td align="right">0.699</td>
<td align="right">0.254</td>
<td align="right">0.676</td>
<td align="right">0.353</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-r"><pre>
plot_roc(<span class="pl-smi">score</span>, <span class="pl-smi">target</span>)
<span class="pl-c">#&gt; Warning: package 'scales' was built under R version 3.2.1</span></pre></div>

<p><img src="vignettes/figures/unnamed-chunk-4-1.png" title="" alt=""></p>

<div class="highlight highlight-r"><pre>
plot_gain(<span class="pl-smi">score</span>, <span class="pl-smi">target</span>)</pre></div>

<p><img src="vignettes/figures/unnamed-chunk-4-2.png" title="" alt=""></p>

<h3>
<a id="odds-table" class="anchor" href="#odds-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Odds Table</h3>

<p>The odds table are other way to show how a score/model performs.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">score</span> <span class="pl-k">&lt;-</span> round(<span class="pl-smi">predictions</span><span class="pl-k">$</span><span class="pl-smi">score</span> <span class="pl-k">*</span> <span class="pl-c1">1000</span>)

odds_table(<span class="pl-smi">score</span>, <span class="pl-smi">target</span>, <span class="pl-v">nclass</span> <span class="pl-k">=</span> <span class="pl-c1">4</span>)</pre></div>

<table>
<thead>
<tr>
<th align="left">variable</th>
<th align="right">count</th>
<th align="right">percent</th>
<th align="right">target_count</th>
<th align="right">target_rate</th>
<th align="right">target_percent</th>
<th align="right">odds</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">[1,199]</td>
<td align="right">2502</td>
<td align="right">0.250</td>
<td align="right">1304</td>
<td align="right">0.521</td>
<td align="right">0.187</td>
<td align="right">1.09</td>
</tr>
<tr>
<td align="left">(199,430]</td>
<td align="right">2504</td>
<td align="right">0.250</td>
<td align="right">1661</td>
<td align="right">0.663</td>
<td align="right">0.238</td>
<td align="right">1.97</td>
</tr>
<tr>
<td align="left">(430,683]</td>
<td align="right">2502</td>
<td align="right">0.250</td>
<td align="right">1894</td>
<td align="right">0.757</td>
<td align="right">0.271</td>
<td align="right">3.12</td>
</tr>
<tr>
<td align="left">(683,996]</td>
<td align="right">2492</td>
<td align="right">0.249</td>
<td align="right">2131</td>
<td align="right">0.855</td>
<td align="right">0.305</td>
<td align="right">5.90</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-r"><pre>
odds_table(<span class="pl-smi">score</span>, <span class="pl-smi">target</span>, <span class="pl-v">breaks</span> <span class="pl-k">=</span> c(<span class="pl-c1">0</span>, <span class="pl-c1">300</span>, <span class="pl-c1">700</span>, <span class="pl-c1">999</span>))</pre></div>

<table>
<thead>
<tr>
<th align="left">variable</th>
<th align="right">count</th>
<th align="right">percent</th>
<th align="right">target_count</th>
<th align="right">target_rate</th>
<th align="right">target_percent</th>
<th align="right">odds</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">(0,300]</td>
<td align="right">3675</td>
<td align="right">0.368</td>
<td align="right">2052</td>
<td align="right">0.558</td>
<td align="right">0.294</td>
<td align="right">1.26</td>
</tr>
<tr>
<td align="left">(300,700]</td>
<td align="right">3978</td>
<td align="right">0.398</td>
<td align="right">2926</td>
<td align="right">0.736</td>
<td align="right">0.419</td>
<td align="right">2.78</td>
</tr>
<tr>
<td align="left">(700,999]</td>
<td align="right">2347</td>
<td align="right">0.235</td>
<td align="right">2012</td>
<td align="right">0.857</td>
<td align="right">0.288</td>
<td align="right">6.01</td>
</tr>
</tbody>
</table>

<h3>
<a id="confusion-matrix" class="anchor" href="#confusion-matrix" aria-hidden="true"><span class="octicon octicon-link"></span></a>Confusion Matrix</h3>

<div class="highlight highlight-r"><pre><span class="pl-smi">score_cat</span> <span class="pl-k">&lt;-</span> ifelse(<span class="pl-smi">score</span> <span class="pl-k">&lt;</span> <span class="pl-c1">500</span>, <span class="pl-c1">0</span>, <span class="pl-c1">1</span>)

conf_matrix(<span class="pl-smi">score_cat</span>, <span class="pl-smi">target</span>)
<span class="pl-c">#&gt; $confusion.matrix</span>
<span class="pl-c">#&gt;    class pred 0 pred 1</span>
<span class="pl-c">#&gt; 0 true 0   2230    780</span>
<span class="pl-c">#&gt; 1 true 1   3476   3514</span>
<span class="pl-c">#&gt; </span>
<span class="pl-c">#&gt; $indicators</span>
<span class="pl-c">#&gt;                               term term.short value</span>
<span class="pl-c">#&gt; 1                         Accuracy         AC 0.574</span>
<span class="pl-c">#&gt; 2 Recall | True Positive rate (GG)     Recall 0.503</span>
<span class="pl-c">#&gt; 3              False Positive rate         FP 0.259</span>
<span class="pl-c">#&gt; 4          True Negative rate (BB)         TN 0.741</span>
<span class="pl-c">#&gt; 5              False Negative rate         FN 0.497</span>
<span class="pl-c">#&gt; 6                        Precision          P 0.818</span>
<span class="pl-c">#&gt; </span>
<span class="pl-c">#&gt; $indicators.t</span>
<span class="pl-c">#&gt;      AC Recall    FP    TN    FN     P</span>
<span class="pl-c">#&gt; 1 0.574  0.503 0.259 0.741 0.497 0.818</span></pre></div>

<h3>
<a id="bivariate-tables" class="anchor" href="#bivariate-tables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bivariate Tables</h3>

<div class="highlight highlight-r"><pre>data(<span class="pl-s"><span class="pl-pds">"</span>credit<span class="pl-pds">"</span></span>)

str(<span class="pl-smi">credit</span>)
<span class="pl-c">#&gt; 'data.frame':    49694 obs. of  17 variables:</span>
<span class="pl-c">#&gt;  $ id_client          : int  1 7 9 12 14 19 22 26 28 30 ...</span>
<span class="pl-c">#&gt;  $ sex                : chr  "F" "F" "F" "F" ...</span>
<span class="pl-c">#&gt;  $ marital_status     : chr  "O" "S" "S" "C" ...</span>
<span class="pl-c">#&gt;  $ age                : int  44 22 27 32 36 46 17 20 71 46 ...</span>
<span class="pl-c">#&gt;  $ flag_res_phone     : chr  "N" "Y" "Y" "Y" ...</span>
<span class="pl-c">#&gt;  $ area_code_res_phone: int  31 31 31 31 31 50 50 50 31 31 ...</span>
<span class="pl-c">#&gt;  $ payment_day        : int  12 12 20 12 12 12 12 12 18 8 ...</span>
<span class="pl-c">#&gt;  $ residence_type     : chr  "P" "A" "A" "P" ...</span>
<span class="pl-c">#&gt;  $ months_in_residence: int  12 0 0 24 120 360 12 12 96 72 ...</span>
<span class="pl-c">#&gt;  $ months_in_the_job  : int  48 48 0 0 36 120 12 24 12 12 ...</span>
<span class="pl-c">#&gt;  $ profession_code    : int  731 999 950 165 15 704 38 39 13 801 ...</span>
<span class="pl-c">#&gt;  $ flag_other_card    : chr  "N" "N" "N" "N" ...</span>
<span class="pl-c">#&gt;  $ flag_mobile_phone  : chr  "N" "N" "N" "N" ...</span>
<span class="pl-c">#&gt;  $ flag_contact_phone : chr  "N" "N" "N" "N" ...</span>
<span class="pl-c">#&gt;  $ personal_net_income: num  300 410 1000 700 1987 ...</span>
<span class="pl-c">#&gt;  $ quant_add_cards    : int  0 0 0 0 1 0 0 0 0 0 ...</span>
<span class="pl-c">#&gt;  $ bad                : int  0 0 1 0 0 0 1 1 0 0 ...</span>

ft(<span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">marital_status</span>)</pre></div>

<table>
<thead>
<tr>
<th align="left">class</th>
<th align="right">count</th>
<th align="right">percent</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">C</td>
<td align="right">17097</td>
<td align="right">0.344</td>
</tr>
<tr>
<td align="left">D</td>
<td align="right">2142</td>
<td align="right">0.043</td>
</tr>
<tr>
<td align="left">O</td>
<td align="right">2776</td>
<td align="right">0.056</td>
</tr>
<tr>
<td align="left">S</td>
<td align="right">25249</td>
<td align="right">0.508</td>
</tr>
<tr>
<td align="left">V</td>
<td align="right">2430</td>
<td align="right">0.049</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-r"><pre>
bt(<span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">marital_status</span>, <span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">bad</span>)</pre></div>

<table>
<thead>
<tr>
<th align="left">variable</th>
<th align="right">count</th>
<th align="right">percent</th>
<th align="right">target_count</th>
<th align="right">target_rate</th>
<th align="right">target_percent</th>
<th align="right">odds</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">C</td>
<td align="right">17097</td>
<td align="right">0.344</td>
<td align="right">2483</td>
<td align="right">0.145</td>
<td align="right">0.253</td>
<td align="right">0.170</td>
</tr>
<tr>
<td align="left">D</td>
<td align="right">2142</td>
<td align="right">0.043</td>
<td align="right">322</td>
<td align="right">0.150</td>
<td align="right">0.033</td>
<td align="right">0.177</td>
</tr>
<tr>
<td align="left">O</td>
<td align="right">2776</td>
<td align="right">0.056</td>
<td align="right">660</td>
<td align="right">0.238</td>
<td align="right">0.067</td>
<td align="right">0.312</td>
</tr>
<tr>
<td align="left">S</td>
<td align="right">25249</td>
<td align="right">0.508</td>
<td align="right">6059</td>
<td align="right">0.240</td>
<td align="right">0.617</td>
<td align="right">0.316</td>
</tr>
<tr>
<td align="left">V</td>
<td align="right">2430</td>
<td align="right">0.049</td>
<td align="right">289</td>
<td align="right">0.119</td>
<td align="right">0.029</td>
<td align="right">0.135</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-r"><pre>
library(<span class="pl-s"><span class="pl-pds">"</span>ggplot2<span class="pl-pds">"</span></span>)

<span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">age_bin</span> <span class="pl-k">&lt;-</span> cut_interval(<span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">age</span>, <span class="pl-c1">4</span>)

bt(<span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">age_bin</span>, <span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">bad</span>)</pre></div>

<table>
<thead>
<tr>
<th align="left">variable</th>
<th align="right">count</th>
<th align="right">percent</th>
<th align="right">target_count</th>
<th align="right">target_rate</th>
<th align="right">target_percent</th>
<th align="right">odds</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">[15,35]</td>
<td align="right">28377</td>
<td align="right">0.571</td>
<td align="right">7015</td>
<td align="right">0.247</td>
<td align="right">0.715</td>
<td align="right">0.328</td>
</tr>
<tr>
<td align="left">(35,55]</td>
<td align="right">17425</td>
<td align="right">0.351</td>
<td align="right">2473</td>
<td align="right">0.142</td>
<td align="right">0.252</td>
<td align="right">0.165</td>
</tr>
<tr>
<td align="left">(55,75]</td>
<td align="right">3767</td>
<td align="right">0.076</td>
<td align="right">313</td>
<td align="right">0.083</td>
<td align="right">0.032</td>
<td align="right">0.091</td>
</tr>
<tr>
<td align="left">(75,95]</td>
<td align="right">125</td>
<td align="right">0.003</td>
<td align="right">12</td>
<td align="right">0.096</td>
<td align="right">0.001</td>
<td align="right">0.106</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-r"><pre>
plot_bt(<span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">age_bin</span>, <span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">bad</span>) <span class="pl-k">+</span> ggtitle(<span class="pl-s"><span class="pl-pds">"</span>Age<span class="pl-pds">"</span></span>)</pre></div>

<p><img src="vignettes/figures/unnamed-chunk-7-1.png" title="" alt=""></p>

<div class="highlight highlight-r"><pre>
plot_bt(<span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">flag_res_phone</span>, <span class="pl-smi">credit</span><span class="pl-k">$</span><span class="pl-smi">bad</span>,
        <span class="pl-v">count.labels</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>, <span class="pl-v">target.labels</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>) <span class="pl-k">+</span>
  ggtitle(<span class="pl-s"><span class="pl-pds">"</span>Flag Response Phone<span class="pl-pds">"</span></span>)</pre></div>

<p><img src="vignettes/figures/unnamed-chunk-7-2.png" title="" alt=""></p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
